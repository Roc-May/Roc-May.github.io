<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Virtuoso61x中做ams仿真记录</title>
      <link href="2021/08/16/virtuoso61x-zhong-zuo-ams-fang-zhen-ji-lu/"/>
      <url>2021/08/16/virtuoso61x-zhong-zuo-ams-fang-zhen-ji-lu/</url>
      
        <content type="html"><![CDATA[<h2 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h2><h3 id="记录"><a href="#记录" class="headerlink" title="记录"></a>记录</h3><p>1.不要在cds.lib里面定义一个名称全部为数字的工程文件夹;</p><p>2.需要在服务器的cadence文件夹下找一下IUSxx,在该目录下找到connectLib文件夹,整个复制到自己的工作目录下或者定义好绝对路径。<br>connectLib中定义的是关于数字模块接口电压等等的定义,所以是做ams混合信号电路仿真时必需的。</p><p>3.IC617版本的virtuoso需要INCISIVE132以及更高版本的，INCISIVE最后一版更新完成于2015年，最后一版是152版本的，irun -version可以查看INCISIVE的版本；之后的Virtuoso版本需要的是Xcelillum.</p><p>4.关于ams仿真提示error，cannot compile ahdlcmi file….,这个是由于lib无法转换导致的。<br>  <img src="https://gitee.com/Gui_xin_peng/picture_warehouse/raw/master/img/error1.jpg" alt="avatar"><br>  <img src="https://gitee.com/Gui_xin_peng/picture_warehouse/raw/master/img/system_lib1.png" alt="avatar"><br>  也即这里的一些库索引需要修改为Virtuoso版本匹配的。【可能系统中同时有615和617多个版本，然后在bashrc和.cshrc中需要区分，在cds.lib中也要调用正确对应的系统库】</p><p>5.<img src="https://gitee.com/Gui_xin_peng/picture_warehouse/raw/master/img/system_lib2.png" alt="avatar"><br>  include所定义的库也要写。include进来的cds.lib软链接到一些其他的库和connectlib，会调用一些virtuoso下的库，然后在incisiv下编译。</p>]]></content>
      
      
      
        <tags>
            
            <tag> Virtuoso </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>基于python的文件传输助手</title>
      <link href="2021/08/16/ji-yu-python-de-wen-jian-chuan-shu-zhu-shou/"/>
      <url>2021/08/16/ji-yu-python-de-wen-jian-chuan-shu-zhu-shou/</url>
      
        <content type="html"><![CDATA[<h2 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h2><h3 id="操作环境"><a href="#操作环境" class="headerlink" title="操作环境"></a>操作环境</h3><p>python3.6+ubuntu18.04</p><h3 id="操作方法"><a href="#操作方法" class="headerlink" title="操作方法"></a>操作方法</h3><p>终端中输入<br>python3 -m http.server（写python3是为了避免在系统同时存在python2和python3时，和python2冲突）<br>打开手机浏览器，网址栏输入<br>你的电脑ip:8000<br>例如：192.168.<strong><em>.</em></strong>:8000<br>监听你的电脑的8000号端口就行，这样你就可以看到你的电脑里面的文件了。</p><h3 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h3><p>注意哦，手机和电脑要在同一个局域网下面，也就是说要连一个网。<br>不过就是只能看，不能上传，有升级的空间。<br>github上看到过一个不错的脚本，分享一下。</p><h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">#!/usr/bin/env python3</span><span class="token triple-quoted-string string">"""Simple HTTP Server With Upload.This module builds on http.server by implementing the standard GETand HEAD requests in a fairly straightforward manner.see: https://gist.github.com/UniIsland/3346170"""</span>__version__ <span class="token operator">=</span> <span class="token string">"0.1"</span>__all__ <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"SimpleHTTPRequestHandler"</span><span class="token punctuation">]</span>__author__ <span class="token operator">=</span> <span class="token string">"bones7456"</span>__home_page__ <span class="token operator">=</span> <span class="token string">"https://gist.github.com/UniIsland/3346170"</span><span class="token keyword">import</span> os<span class="token keyword">import</span> posixpath<span class="token keyword">import</span> http<span class="token punctuation">.</span>server<span class="token keyword">import</span> socketserver<span class="token keyword">import</span> urllib<span class="token punctuation">.</span>request<span class="token punctuation">,</span> urllib<span class="token punctuation">.</span>parse<span class="token punctuation">,</span> urllib<span class="token punctuation">.</span>error<span class="token keyword">import</span> html<span class="token keyword">import</span> shutil<span class="token keyword">import</span> mimetypes<span class="token keyword">import</span> re<span class="token keyword">import</span> argparse<span class="token keyword">import</span> base64<span class="token keyword">from</span> io <span class="token keyword">import</span> BytesIO<span class="token keyword">class</span> <span class="token class-name">SimpleHTTPRequestHandler</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>server<span class="token punctuation">.</span>BaseHTTPRequestHandler<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""Simple HTTP request handler with GET/HEAD/POST commands.    This serves files from the current directory and any of its    subdirectories.  The MIME type for files is determined by    calling the .guess_type() method. And can reveive file uploaded    by client.    The GET/HEAD/POST requests are identical except that the HEAD    request omits the actual contents of the file.    """</span>    server_version <span class="token operator">=</span> <span class="token string">"SimpleHTTPWithUpload/"</span> <span class="token operator">+</span> __version__    <span class="token keyword">def</span> <span class="token function">do_GET</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token triple-quoted-string string">"""Serve a GET request."""</span>        f <span class="token operator">=</span> self<span class="token punctuation">.</span>send_head<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> f<span class="token punctuation">:</span>            self<span class="token punctuation">.</span>copyfile<span class="token punctuation">(</span>f<span class="token punctuation">,</span> self<span class="token punctuation">.</span>wfile<span class="token punctuation">)</span>            f<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">do_HEAD</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token triple-quoted-string string">"""Serve a HEAD request."""</span>        f <span class="token operator">=</span> self<span class="token punctuation">.</span>send_head<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> f<span class="token punctuation">:</span>            f<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">do_POST</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token triple-quoted-string string">"""Serve a POST request."""</span>        r<span class="token punctuation">,</span> info <span class="token operator">=</span> self<span class="token punctuation">.</span>deal_post_data<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token punctuation">(</span>r<span class="token punctuation">,</span> info<span class="token punctuation">,</span> <span class="token string">"by: "</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>client_address<span class="token punctuation">)</span><span class="token punctuation">)</span>        f <span class="token operator">=</span> BytesIO<span class="token punctuation">(</span><span class="token punctuation">)</span>        f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>b<span class="token string">'&lt;!DOCTYPE html PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">'</span><span class="token punctuation">)</span>        f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>b<span class="token string">"&lt;html>\n&lt;title>Upload Result Page&lt;/title>\n"</span><span class="token punctuation">)</span>        f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>b<span class="token string">"&lt;body>\n&lt;h2>Upload Result Page&lt;/h2>\n"</span><span class="token punctuation">)</span>        f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>b<span class="token string">"&lt;hr>\n"</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> r<span class="token punctuation">:</span>            f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>b<span class="token string">"&lt;strong>Success:&lt;/strong>"</span><span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>b<span class="token string">"&lt;strong>Failed:&lt;/strong>"</span><span class="token punctuation">)</span>        f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>info<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        f<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">"&lt;br>&lt;a href=\"%s\">back&lt;/a>"</span> <span class="token operator">%</span> self<span class="token punctuation">.</span>headers<span class="token punctuation">[</span><span class="token string">'referer'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>b<span class="token string">"&lt;hr>&lt;small>Powered By: bones7456, check new version at "</span><span class="token punctuation">)</span>        f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>b<span class="token string">"&lt;a href=\"https://gist.github.com/UniIsland/3346170\">"</span><span class="token punctuation">)</span>        f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>b<span class="token string">"here&lt;/a>.&lt;/small>&lt;/body>\n&lt;/html>\n"</span><span class="token punctuation">)</span>        length <span class="token operator">=</span> f<span class="token punctuation">.</span>tell<span class="token punctuation">(</span><span class="token punctuation">)</span>        f<span class="token punctuation">.</span>seek<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>send_response<span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>send_header<span class="token punctuation">(</span><span class="token string">"Content-type"</span><span class="token punctuation">,</span> <span class="token string">"text/html"</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>send_header<span class="token punctuation">(</span><span class="token string">"Content-Length"</span><span class="token punctuation">,</span> str<span class="token punctuation">(</span>length<span class="token punctuation">)</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>end_headers<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> f<span class="token punctuation">:</span>            self<span class="token punctuation">.</span>copyfile<span class="token punctuation">(</span>f<span class="token punctuation">,</span> self<span class="token punctuation">.</span>wfile<span class="token punctuation">)</span>            f<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">deal_post_data</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        uploaded_files <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>        content_type <span class="token operator">=</span> self<span class="token punctuation">.</span>headers<span class="token punctuation">[</span><span class="token string">'content-type'</span><span class="token punctuation">]</span>        <span class="token keyword">if</span> <span class="token operator">not</span> content_type<span class="token punctuation">:</span>            <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token string">"Content-Type header doesn't contain boundary"</span><span class="token punctuation">)</span>        boundary <span class="token operator">=</span> content_type<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">"="</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span>        remainbytes <span class="token operator">=</span> int<span class="token punctuation">(</span>self<span class="token punctuation">.</span>headers<span class="token punctuation">[</span><span class="token string">'content-length'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>        line <span class="token operator">=</span> self<span class="token punctuation">.</span>rfile<span class="token punctuation">.</span>readline<span class="token punctuation">(</span><span class="token punctuation">)</span>        remainbytes <span class="token operator">-=</span> len<span class="token punctuation">(</span>line<span class="token punctuation">)</span>        <span class="token keyword">if</span> <span class="token operator">not</span> boundary <span class="token keyword">in</span> line<span class="token punctuation">:</span>            <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token string">"Content NOT begin with boundary"</span><span class="token punctuation">)</span>        <span class="token keyword">while</span> remainbytes <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">:</span>            line <span class="token operator">=</span> self<span class="token punctuation">.</span>rfile<span class="token punctuation">.</span>readline<span class="token punctuation">(</span><span class="token punctuation">)</span>            remainbytes <span class="token operator">-=</span> len<span class="token punctuation">(</span>line<span class="token punctuation">)</span>            fn <span class="token operator">=</span> re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span>r<span class="token string">'Content-Disposition.*name="file"; filename="(.*)"'</span><span class="token punctuation">,</span> line<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token keyword">if</span> <span class="token operator">not</span> fn<span class="token punctuation">:</span>                <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token string">"Can't find out file name..."</span><span class="token punctuation">)</span>            path <span class="token operator">=</span> self<span class="token punctuation">.</span>translate_path<span class="token punctuation">(</span>self<span class="token punctuation">.</span>path<span class="token punctuation">)</span>            fn <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>path<span class="token punctuation">,</span> fn<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>            line <span class="token operator">=</span> self<span class="token punctuation">.</span>rfile<span class="token punctuation">.</span>readline<span class="token punctuation">(</span><span class="token punctuation">)</span>            remainbytes <span class="token operator">-=</span> len<span class="token punctuation">(</span>line<span class="token punctuation">)</span>            line <span class="token operator">=</span> self<span class="token punctuation">.</span>rfile<span class="token punctuation">.</span>readline<span class="token punctuation">(</span><span class="token punctuation">)</span>            remainbytes <span class="token operator">-=</span> len<span class="token punctuation">(</span>line<span class="token punctuation">)</span>            <span class="token keyword">try</span><span class="token punctuation">:</span>                out <span class="token operator">=</span> open<span class="token punctuation">(</span>fn<span class="token punctuation">,</span> <span class="token string">'wb'</span><span class="token punctuation">)</span>            <span class="token keyword">except</span> IOError<span class="token punctuation">:</span>                <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token string">"Can't create file to write, do you have permission to write?"</span><span class="token punctuation">)</span>            <span class="token keyword">else</span><span class="token punctuation">:</span>                <span class="token keyword">with</span> out<span class="token punctuation">:</span>                    preline <span class="token operator">=</span> self<span class="token punctuation">.</span>rfile<span class="token punctuation">.</span>readline<span class="token punctuation">(</span><span class="token punctuation">)</span>                    remainbytes <span class="token operator">-=</span> len<span class="token punctuation">(</span>preline<span class="token punctuation">)</span>                    <span class="token keyword">while</span> remainbytes <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">:</span>                        line <span class="token operator">=</span> self<span class="token punctuation">.</span>rfile<span class="token punctuation">.</span>readline<span class="token punctuation">(</span><span class="token punctuation">)</span>                        remainbytes <span class="token operator">-=</span> len<span class="token punctuation">(</span>line<span class="token punctuation">)</span>                        <span class="token keyword">if</span> boundary <span class="token keyword">in</span> line<span class="token punctuation">:</span>                            preline <span class="token operator">=</span> preline<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>                            <span class="token keyword">if</span> preline<span class="token punctuation">.</span>endswith<span class="token punctuation">(</span>b<span class="token string">'\r'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                                preline <span class="token operator">=</span> preline<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>                            out<span class="token punctuation">.</span>write<span class="token punctuation">(</span>preline<span class="token punctuation">)</span>                            uploaded_files<span class="token punctuation">.</span>append<span class="token punctuation">(</span>fn<span class="token punctuation">)</span>                            <span class="token keyword">break</span>                        <span class="token keyword">else</span><span class="token punctuation">:</span>                            out<span class="token punctuation">.</span>write<span class="token punctuation">(</span>preline<span class="token punctuation">)</span>                            preline <span class="token operator">=</span> line        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">,</span> <span class="token string">"File '%s' upload success!"</span> <span class="token operator">%</span> <span class="token string">","</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>uploaded_files<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">send_head</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token triple-quoted-string string">"""Common code for GET and HEAD commands.        This sends the response code and MIME headers.        Return value is either a file object (which has to be copied        to the outputfile by the caller unless the command was HEAD,        and must be closed by the caller under all circumstances), or        None, in which case the caller has nothing further to do.        """</span>        path <span class="token operator">=</span> self<span class="token punctuation">.</span>translate_path<span class="token punctuation">(</span>self<span class="token punctuation">.</span>path<span class="token punctuation">)</span>        f <span class="token operator">=</span> None        <span class="token keyword">if</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>isdir<span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">if</span> <span class="token operator">not</span> self<span class="token punctuation">.</span>path<span class="token punctuation">.</span>endswith<span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                <span class="token comment" spellcheck="true"># redirect browser - doing basically what apache does</span>                self<span class="token punctuation">.</span>send_response<span class="token punctuation">(</span><span class="token number">301</span><span class="token punctuation">)</span>                self<span class="token punctuation">.</span>send_header<span class="token punctuation">(</span><span class="token string">"Location"</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>path <span class="token operator">+</span> <span class="token string">"/"</span><span class="token punctuation">)</span>                self<span class="token punctuation">.</span>end_headers<span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token keyword">return</span> None            <span class="token keyword">for</span> index <span class="token keyword">in</span> <span class="token string">"index.html"</span><span class="token punctuation">,</span> <span class="token string">"index.htm"</span><span class="token punctuation">:</span>                index <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>path<span class="token punctuation">,</span> index<span class="token punctuation">)</span>                <span class="token keyword">if</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">:</span>                    path <span class="token operator">=</span> index                    <span class="token keyword">break</span>            <span class="token keyword">else</span><span class="token punctuation">:</span>                <span class="token keyword">return</span> self<span class="token punctuation">.</span>list_directory<span class="token punctuation">(</span>path<span class="token punctuation">)</span>        ctype <span class="token operator">=</span> self<span class="token punctuation">.</span>guess_type<span class="token punctuation">(</span>path<span class="token punctuation">)</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            <span class="token comment" spellcheck="true"># Always read in binary mode. Opening files in text mode may cause</span>            <span class="token comment" spellcheck="true"># newline translations, making the actual size of the content</span>            <span class="token comment" spellcheck="true"># transmitted *less* than the content-length!</span>            f <span class="token operator">=</span> open<span class="token punctuation">(</span>path<span class="token punctuation">,</span> <span class="token string">'rb'</span><span class="token punctuation">)</span>        <span class="token keyword">except</span> IOError<span class="token punctuation">:</span>            self<span class="token punctuation">.</span>send_error<span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">,</span> <span class="token string">"File not found"</span><span class="token punctuation">)</span>            <span class="token keyword">return</span> None        self<span class="token punctuation">.</span>send_response<span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>send_header<span class="token punctuation">(</span><span class="token string">"Content-type"</span><span class="token punctuation">,</span> ctype<span class="token punctuation">)</span>        fs <span class="token operator">=</span> os<span class="token punctuation">.</span>fstat<span class="token punctuation">(</span>f<span class="token punctuation">.</span>fileno<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>send_header<span class="token punctuation">(</span><span class="token string">"Content-Length"</span><span class="token punctuation">,</span> str<span class="token punctuation">(</span>fs<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>send_header<span class="token punctuation">(</span><span class="token string">"Last-Modified"</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>date_time_string<span class="token punctuation">(</span>fs<span class="token punctuation">.</span>st_mtime<span class="token punctuation">)</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>end_headers<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> f    <span class="token keyword">def</span> <span class="token function">list_directory</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> path<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token triple-quoted-string string">"""Helper to produce a directory listing (absent index.html).        Return value is either a file object, or None (indicating an        error).  In either case, the headers are sent, making the        interface the same as for send_head().        """</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            list <span class="token operator">=</span> os<span class="token punctuation">.</span>listdir<span class="token punctuation">(</span>path<span class="token punctuation">)</span>        <span class="token keyword">except</span> os<span class="token punctuation">.</span>error<span class="token punctuation">:</span>            self<span class="token punctuation">.</span>send_error<span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">,</span> <span class="token string">"No permission to list directory"</span><span class="token punctuation">)</span>            <span class="token keyword">return</span> None        list<span class="token punctuation">.</span>sort<span class="token punctuation">(</span>key<span class="token operator">=</span><span class="token keyword">lambda</span> a<span class="token punctuation">:</span> a<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        f <span class="token operator">=</span> BytesIO<span class="token punctuation">(</span><span class="token punctuation">)</span>        displaypath <span class="token operator">=</span> html<span class="token punctuation">.</span>escape<span class="token punctuation">(</span>urllib<span class="token punctuation">.</span>parse<span class="token punctuation">.</span>unquote<span class="token punctuation">(</span>self<span class="token punctuation">.</span>path<span class="token punctuation">)</span><span class="token punctuation">)</span>        f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>b<span class="token string">'&lt;!DOCTYPE html PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">'</span><span class="token punctuation">)</span>        f<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">"&lt;html>\n&lt;title>Directory listing for %s&lt;/title>\n"</span> <span class="token operator">%</span> displaypath<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>b<span class="token string">'&lt;style type="text/css">\n'</span><span class="token punctuation">)</span>        f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>b<span class="token string">'a &amp;#123; text-decoration: none; &amp;#125;\n'</span><span class="token punctuation">)</span>        f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>b<span class="token string">'a:link &amp;#123; text-decoration: none; font-weight: bold; color: #0000ff; &amp;#125;\n'</span><span class="token punctuation">)</span>        f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>b<span class="token string">'a:visited &amp;#123; text-decoration: none; font-weight: bold; color: #0000ff; &amp;#125;\n'</span><span class="token punctuation">)</span>        f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>b<span class="token string">'a:active &amp;#123; text-decoration: none; font-weight: bold; color: #0000ff; &amp;#125;\n'</span><span class="token punctuation">)</span>        f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>b<span class="token string">'a:hover &amp;#123; text-decoration: none; font-weight: bold; color: #ff0000; &amp;#125;\n'</span><span class="token punctuation">)</span>        f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>b<span class="token string">'&lt;/style>\n'</span><span class="token punctuation">)</span>        f<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">"&lt;body>\n&lt;h2>Directory listing for %s&lt;/h2>\n"</span> <span class="token operator">%</span> displaypath<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>b<span class="token string">"&lt;hr>\n"</span><span class="token punctuation">)</span>        f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>b<span class="token string">"&lt;form ENCTYPE=\"multipart/form-data\" method=\"post\">"</span><span class="token punctuation">)</span>        f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>b<span class="token string">"&lt;input name=\"file\" type=\"file\" multiple/>"</span><span class="token punctuation">)</span>        f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>b<span class="token string">"&lt;input type=\"submit\" value=\"upload\"/>&lt;/form>\n"</span><span class="token punctuation">)</span>        f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>b<span class="token string">"&lt;hr>\n"</span><span class="token punctuation">)</span>        f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>b<span class="token string">'&lt;a href="../">&lt;img src="data:image/gif;base64,R0lGODlhGAAYAMIAAP///7+/v7u7u1ZWVTc3NwAAAAAAAAAAACH+RFRoaXMgaWNvbiBpcyBpbiB0aGUgcHVibGljIGRvbWFpbi4gMTk5NSBLZXZpbiBIdWdoZXMsIGtldmluaEBlaXQuY29tACH5BAEAAAEALAAAAAAYABgAAANKGLrc/jBKNgIhM4rLcaZWd33KJnJkdaKZuXqTugYFeSpFTVpLnj86oM/n+DWGyCAuyUQymlDiMtrsUavP6xCizUB3NCW4Ny6bJwkAOw==" alt="[PARENTDIR]" width="24" height="24">&amp;nbsp;&amp;nbsp;&amp;nbsp;Parent Directory&lt;/a>&lt;br />\n'</span><span class="token punctuation">)</span>        <span class="token keyword">for</span> name <span class="token keyword">in</span> list<span class="token punctuation">:</span>            dirimage <span class="token operator">=</span> <span class="token string">'data:image/gif;base64,R0lGODlhGAAYAMIAAP///7+/v7u7u1ZWVTc3NwAAAAAAAAAAACH+RFRoaXMgaWNvbiBpcyBpbiB0aGUgcHVibGljIGRvbWFpbi4gMTk5NSBLZXZpbiBIdWdoZXMsIGtldmluaEBlaXQuY29tACH5BAEAAAEALAAAAAAYABgAAANdGLrc/jAuQaulQwYBuv9cFnFfSYoPWXoq2qgrALsTYN+4QOg6veFAG2FIdMCCNgvBiAxWlq8mUseUBqGMoxWArW1xXYXWGv59b+WxNH1GV9vsNvd9jsMhxLw+70gAADs='</span>            fullname <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>path<span class="token punctuation">,</span> name<span class="token punctuation">)</span>            displayname <span class="token operator">=</span> linkname <span class="token operator">=</span> name            <span class="token comment" spellcheck="true"># Append / for directories or @ for symbolic links</span>            <span class="token keyword">if</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>isdir<span class="token punctuation">(</span>fullname<span class="token punctuation">)</span><span class="token punctuation">:</span>                dirimage <span class="token operator">=</span> <span class="token string">'data:image/gif;base64,R0lGODlhGAAYAMIAAP///+jNlr+/v6KXfm5SG2lPGjc3NwAAACH+RFRoaXMgaWNvbiBpcyBpbiB0aGUgcHVibGljIGRvbWFpbi4gMTk5NSBLZXZpbiBIdWdoZXMsIGtldmluaEBlaXQuY29tACH5BAEAAAIALAAAAAAYABgAAANjKLrc/jDKSau9WJbN9y1BKIZFVQzjOHRdsw1wDIMpyYAFke9ELa4Lmm9IWBkUwqHPiFQSmYKkU1U4Rqe1YrWJTUGlWK0VjP12R2Jubx1guwPQqGxOj22DrLzeujD4/4CBgAoJADs='</span>                displayname <span class="token operator">=</span> name <span class="token operator">+</span> <span class="token string">"/"</span>                linkname <span class="token operator">=</span> name <span class="token operator">+</span> <span class="token string">"/"</span>            <span class="token keyword">if</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>islink<span class="token punctuation">(</span>fullname<span class="token punctuation">)</span><span class="token punctuation">:</span>                dirimage <span class="token operator">=</span> <span class="token string">'data:image/gif;base64,R0lGODlhGAAYAPf/AJaWlpqampubm5ycnJ2dnZ6enp+fn6CgoKGhoaKioqOjo6SkpKWlpaampqioqKmpqaqqqqurq6ysrK2tra6urq+vr7CwsLGxsbKysrOzs7S0tLW1tba2tre3t7i4uLm5ubq6uru7u7y8vL29vb6+vr+/v8LCwsPDw8bGxtDQ0NTU1NXV1dbW1tfX19jY2Nra2tzc3N3d3eDg4OHh4eLi4uPj4+Tk5OXl5efn5+np6erq6uvr6+zs7O7u7u/v7/Dw8PHx8fLy8vPz8/T09PX19fb29vf39/j4+Pr6+vv7+/39/f7+/v///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACwAAAAAGAAYAAAI/wCZCBxIsKDBgwgLrsigwUXChEVGYNBwIYKIJA8LFunwocKGDA8ieMg4kAiHDxRmCGyhIAEKkhtR2iCYYYEAkiNQ3ijYIQGAjDkuVFBJsIcBAhcyttCgoSCQBQcUFMn44gIFEiwE/oAqIAfJIREeQLDAZIeCAwO8IuQRowYSIxQgBFhAoQBatQaFiLCQoQIFCxEMREUwoAEPhEA0dMQwQSwCIEFYpKCR8IfiCjWYgJCr4AhJyx13CFRhQYECGBmRcKwgmmAEBCsyltBQQUfBGwUG4MjoYMOIgjsSIJBAskGGEAR3IEhw4AdJExIeyBCIY/kBHySZLNEwgcGGDQYQNBbPLpAIBgULEhB4AIQ8wRMFBIhQ4j4gADs='</span>                displayname <span class="token operator">=</span> name <span class="token operator">+</span> <span class="token string">"@"</span>            <span class="token keyword">if</span> name<span class="token punctuation">.</span>endswith<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">'.bmp'</span><span class="token punctuation">,</span><span class="token string">'.gif'</span><span class="token punctuation">,</span><span class="token string">'.jpg'</span><span class="token punctuation">,</span><span class="token string">'.png'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                dirimage <span class="token operator">=</span> name            <span class="token keyword">if</span> name<span class="token punctuation">.</span>endswith<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">'.avi'</span><span class="token punctuation">,</span><span class="token string">'.mpg'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                dirimage <span class="token operator">=</span> <span class="token string">'data:image/gif;base64,R0lGODlhGAAYAMIAAP///7+/v7u7u1ZWVTc3NwAAAAAAAAAAACH+RFRoaXMgaWNvbiBpcyBpbiB0aGUgcHVibGljIGRvbWFpbi4gMTk5NSBLZXZpbiBIdWdoZXMsIGtldmluaEBlaXQuY29tACH5BAEAAAEALAAAAAAYABgAAANvGLrc/jAuQqu99BEh8OXE4GzdYJ4mQIZjNXAwp7oj+MbyKjY6ntstyg03E9ZKPoEKyLMll6UgAUCtVi07xspTYWptqBOUxXM9scfQ2Ttx+sbZifmNbiLpbEUPHy1TrIB1Xx1cFHkBW4VODmGNjQ4JADs='</span>            <span class="token keyword">if</span> name<span class="token punctuation">.</span>endswith<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">'.idx'</span><span class="token punctuation">,</span><span class="token string">'.srt'</span><span class="token punctuation">,</span><span class="token string">'.sub'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                dirimage <span class="token operator">=</span> <span class="token string">'data:image/gif;base64,R0lGODlhGAAYAPf/AAAbDiAfDSoqHjQlADs+J3sxJ0BALERHMk5LN1pSPUZHRk9NQU1OR05ZUFBRRFVXTVdYTVtVQFlVRFtbSF5bTVZWUltbUFlZVFtcVlxdWl5eWl1gWmBiV2FiXWNhXGRjXWlpYmtqZ2xtZmxsaG5ubHJva3Jzb3J0bHN0b3Z5dHd8eXh4dX18dXx/dnt8e31+eahMP4JdWIdnZox4cpVoYKJkXrxqablwcNA6Otg7O/8AAPwHB/0GBvgODvsMDPMbG/ceHvkSEuYqKvYqKvU2NvM6OvQ6OsFQUNVbW8N4eNd0duNeXu9aWvFUVOVqau1jY+1mZu5mZuh5eYSFgIWGgYaFgIiGgYqKiY6LioyMiY2NiYyMio2OiI6OjZCSjZSQi5OSkJGUkpSVk5WVlJWVlZiZlpiZmJ6emp2dnZSko6GhnKGhoKOjoaKnoqSkpKSmpKWmpaampqqrqKurqKqrqq2sqq6urrSyrrCwsLa3tb63tbi4t7q6ur+/vsCbm96Li9iUlMqursmwr9KwsN69veSCguiMjOiOjuaQkOWVleaXmOGfn+aYmOaamuebm+adneecnOeenuiQkOWgoOWsrOasrOWxseW2tue3t+e8vOi+vsHBwcfHx8jIxs7Mx8nJyMvLy8zMy83NzM7Pzs/Pz9PR0dTU1NXV1dXW1tbW1tfX19bb29jY2NnZ2djb29ra2tvb2tvb29za2tzc3N3d3d7e3t/f3+bCwufDw+fGxuTJyejCwujHx+nHx+vPz+rT0+rU1OrX1+vX1+rY2Ojf3+Hh4eLi4uPj4+Hn5+Tk5OXl5ebm5ufn5+nn5+jo6Onp6erp6evr6+zs7PDn5/Dq6vDt7fHv7/Lu7vPu7vPv7/Dw8PHx8fLy8vPz8/Tx8fbz8/T09PX19fX39/b29vj39/j4+Pn4+Pn5+fr5+fr6+vv7+/z7+/z8/P39/f7+/v/+/v///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACwAAAAAGAAYAAAI/wDhCRxIsKDBgwgTZis00F27hAbRNSpSaSC7ZM6ePQsXjdmzZekKUpOio0lBVShjJXvYjp07gsEm/dLhqKC2aNG2LesES13BXJTg4dLBi2C7kPDSyQFTRY26c8akZbolkJGOaQTZFTO2LA8KCCA+zDFTp4aggVCCmCtYrJUxNiI4nAjh4o2HGW1CrhvCxGC5cOVqvcCgQQUWGRtanOkG75qOQwXbhWvZ7lOZMIGSsJjihY5AYTowFWRnipUtT6BGWIARY8IXPc1eXtIxrKC7cqJCjdJCIcIBAwRoaLqU6IkRHthGnwPzoEGKDBISMHDAZWAvHUTWjaa1J42NAgAELMBAMGCNwHbWekQxqA4VMkBKSokZE8AKtHLpjuHxo0OSQXfuLKJIOHdc0IECFaxgQivpxHGDDpYc9McS5oBTAhxUbNHFFX2I4Q4fR+iwi0GPCCGLK6rYgQYJWZDhBil7cMMJDjpAAg85L8ETCRDVqAONMuGMA0446rDjEzzi5KDDD4j48g48huxAyCqtODNZOeWcM85DAxEDzDcE+YDEK5u0EostbZ2SyizsQASPE4PAo4466TxVZzptuqmLN266GRAAOw=='</span>            <span class="token keyword">if</span> name<span class="token punctuation">.</span>endswith<span class="token punctuation">(</span><span class="token string">'.iso'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                dirimage <span class="token operator">=</span> <span class="token string">'data:image/gif;base64,R0lGODlhGAAYAPf/AKysrLGxsbe3t7i4uLm5uLm5ubq6ury8vL29vb6+vry+wb2+wKfeu7XGsbjNtr3UprnVqbbcvqjOzKTM0KbdwKvX2anZ1b/CxbTbw63R5LHS5b3T5dexrtuxrty+p+KvpOCxo8bLnsvJotjAptTPs9HRtcDAwMHBwcLCwsPDw8PCxMLDxsTDwsTEw8TExMXFxcbGxsfHx8jIyMnJycrJysrKysvLy87Ly8zMzM3Nzc7Ozs/PzsDe3NDQ0NHR0dLR0NLS0tPT09TU1NXV1dXW1tbW1tfX19HZ0dLb0NjV1NrW1djY2NnZ2dra2t3a2tzc3N3d3d7e3d/f3t/f38HU5cPf6sff68/e69Pf6sDi3Nng59zh5d7k5ujEw+nFxOnGxunIx+vLx+zNyePTy+Hf3+3Y0eDg3+Tg3+Dg4OHh4uLi4eLi4uPj4uPj4+Hj5OPk4+Th4OTk4+Tk5OXl5OXl5eXm5ebl5Obm5ebm5ubn5ufn5ufn5+Lm6uXo6unj4+rl5Ojo5+jo6Onp6Onp6erq6erq6urr6+vr6uvr6+vs6+zp6e3r6uzs6+zs7O3t7e3u7e7u7e7u7u/v7u/v7+fv9ezu8e3u8PDp6fHr6/Dw8PHx8PHx8fLy8fLy8vPy8vPz8vPz8/Tz8/T08/T09PX19PX19fX29fb19Pb29vf39vf39/j49/j4+Pn4+Pn5+Pn5+fr6+fr6+vv7+vv7+/z8+/z8/P39/P39/f7+/f7+/v7//////wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACwAAAAAGAAYAAAI/wB3CRxIsKBBg4hi6GCyBs+eQIH2PJSIB82QGYgKDnqBowmeRpEiTSo0qVGmSI3oGJkxSOOLGkXkIJpkBEEQHzagZEq5siXBjTOGtJnpwweKBFCE7FTJ0mXQoZH2TIGCh4kjR4jkFGn684UMIXIGTWkSpQ0bOTIbaa3hc+BGGUSeFIkyhxCkT6hKDaKztq3AQS5m3EgSZw4gRplIvbq1KxIUI2w1umDBAQycPIQkgVo1K9etWXSARP6pooGID1/+POKEKtatXLFSfQLCdWChBRIYPPAgBpMpVrV20WIFKpMUF4UKElKwIYOFCCTKKCrUSBWsUpkY3WmR/KcLN1quVPLJgmTRrViBPHlyJAgPDL+7BsW4AyhRJUpcQO3S1YePpUN62FHbXy/sUYgkobQiCSKvnHIED1ZgscUb72l0gh6OsCYLLY60QcYYJWBQgQZUXEBIQYWYYAYnitmSCy2ldHJJGCNAQMEEK3TnVgo5jMJZLra8UoomjfjRBQghOEADfIW88AIdtdyCSyyocMJeHWd40cEPA+4SSGA+TLJLLauAIkkhesgRhxJOLCHDHgXhwVETbTjCiiuiSHIIIGo8UYghTcyAR0GgyDCAAAYMEMAJO/QwAwEAFHCAAQXIMMpBmzhSyCCD4JHGFA0FMkghMxEUEAA7'</span>            <span class="token comment" spellcheck="true"># Note: a link to a directory displays with @ and links with /</span>            f<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">'&lt;a href="%s">&lt;img src="%s" width="24" height="24">&amp;nbsp;&amp;nbsp;&amp;nbsp;%s&lt;/a>&lt;br />\n'</span>                    <span class="token operator">%</span> <span class="token punctuation">(</span>urllib<span class="token punctuation">.</span>parse<span class="token punctuation">.</span>quote<span class="token punctuation">(</span>linkname<span class="token punctuation">)</span><span class="token punctuation">,</span> dirimage <span class="token punctuation">,</span> html<span class="token punctuation">.</span>escape<span class="token punctuation">(</span>displayname<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>b<span class="token string">"&lt;hr>\n&lt;/body>\n&lt;/html>\n"</span><span class="token punctuation">)</span>        length <span class="token operator">=</span> f<span class="token punctuation">.</span>tell<span class="token punctuation">(</span><span class="token punctuation">)</span>        f<span class="token punctuation">.</span>seek<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>send_response<span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>send_header<span class="token punctuation">(</span><span class="token string">"Content-type"</span><span class="token punctuation">,</span> <span class="token string">"text/html"</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>send_header<span class="token punctuation">(</span><span class="token string">"Content-Length"</span><span class="token punctuation">,</span> str<span class="token punctuation">(</span>length<span class="token punctuation">)</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>end_headers<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> f    <span class="token keyword">def</span> <span class="token function">translate_path</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> path<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token triple-quoted-string string">"""Translate a /-separated PATH to the local filename syntax.        Components that mean special things to the local file system        (e.g. drive or directory names) are ignored.  (XXX They should        probably be diagnosed.)        """</span>        <span class="token comment" spellcheck="true"># abandon query parameters</span>        path <span class="token operator">=</span> path<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'?'</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>        path <span class="token operator">=</span> path<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'#'</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>        path <span class="token operator">=</span> posixpath<span class="token punctuation">.</span>normpath<span class="token punctuation">(</span>urllib<span class="token punctuation">.</span>parse<span class="token punctuation">.</span>unquote<span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">)</span>        words <span class="token operator">=</span> path<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span>        words <span class="token operator">=</span> <span class="token punctuation">[</span>_f <span class="token keyword">for</span> _f <span class="token keyword">in</span> words <span class="token keyword">if</span> _f<span class="token punctuation">]</span>        path <span class="token operator">=</span> os<span class="token punctuation">.</span>getcwd<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">for</span> word <span class="token keyword">in</span> words<span class="token punctuation">:</span>            drive<span class="token punctuation">,</span> word <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>splitdrive<span class="token punctuation">(</span>word<span class="token punctuation">)</span>            head<span class="token punctuation">,</span> word <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>split<span class="token punctuation">(</span>word<span class="token punctuation">)</span>            <span class="token keyword">if</span> word <span class="token keyword">in</span> <span class="token punctuation">(</span>os<span class="token punctuation">.</span>curdir<span class="token punctuation">,</span> os<span class="token punctuation">.</span>pardir<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">continue</span>            path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>path<span class="token punctuation">,</span> word<span class="token punctuation">)</span>        <span class="token keyword">return</span> path    <span class="token keyword">def</span> <span class="token function">copyfile</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> source<span class="token punctuation">,</span> outputfile<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token triple-quoted-string string">"""Copy all data between two file objects.        The SOURCE argument is a file object open for reading        (or anything with a read() method) and the DESTINATION        argument is a file object open for writing (or        anything with a write() method).        The only reason for overriding this would be to change        the block size or perhaps to replace newlines by CRLF        -- note however that this the default server uses this        to copy binary data as well.        """</span>        shutil<span class="token punctuation">.</span>copyfileobj<span class="token punctuation">(</span>source<span class="token punctuation">,</span> outputfile<span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">guess_type</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> path<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token triple-quoted-string string">"""Guess the type of a file.        Argument is a PATH (a filename).        Return value is a string of the form type/subtype,        usable for a MIME Content-type header.        The default implementation looks the file's extension        up in the table self.extensions_map, using application/octet-stream        as a default; however it would be permissible (if        slow) to look inside the data to make a better guess.        """</span>        base<span class="token punctuation">,</span> ext <span class="token operator">=</span> posixpath<span class="token punctuation">.</span>splitext<span class="token punctuation">(</span>path<span class="token punctuation">)</span>        <span class="token keyword">if</span> ext <span class="token keyword">in</span> self<span class="token punctuation">.</span>extensions_map<span class="token punctuation">:</span>            <span class="token keyword">return</span> self<span class="token punctuation">.</span>extensions_map<span class="token punctuation">[</span>ext<span class="token punctuation">]</span>        ext <span class="token operator">=</span> ext<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> ext <span class="token keyword">in</span> self<span class="token punctuation">.</span>extensions_map<span class="token punctuation">:</span>            <span class="token keyword">return</span> self<span class="token punctuation">.</span>extensions_map<span class="token punctuation">[</span>ext<span class="token punctuation">]</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> self<span class="token punctuation">.</span>extensions_map<span class="token punctuation">[</span><span class="token string">''</span><span class="token punctuation">]</span>    <span class="token keyword">if</span> <span class="token operator">not</span> mimetypes<span class="token punctuation">.</span>inited<span class="token punctuation">:</span>        mimetypes<span class="token punctuation">.</span>init<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># try to read system mime.types</span>    extensions_map <span class="token operator">=</span> mimetypes<span class="token punctuation">.</span>types_map<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>    extensions_map<span class="token punctuation">.</span>update<span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;</span>        <span class="token string">''</span><span class="token punctuation">:</span> <span class="token string">'application/octet-stream'</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true"># Default</span>        <span class="token string">'.py'</span><span class="token punctuation">:</span> <span class="token string">'text/plain'</span><span class="token punctuation">,</span>        <span class="token string">'.c'</span><span class="token punctuation">:</span> <span class="token string">'text/plain'</span><span class="token punctuation">,</span>        <span class="token string">'.h'</span><span class="token punctuation">:</span> <span class="token string">'text/plain'</span><span class="token punctuation">,</span>        <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;)</span>parser <span class="token operator">=</span> argparse<span class="token punctuation">.</span>ArgumentParser<span class="token punctuation">(</span><span class="token punctuation">)</span>parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'--bind'</span><span class="token punctuation">,</span> <span class="token string">'-b'</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">,</span> metavar<span class="token operator">=</span><span class="token string">'ADDRESS'</span><span class="token punctuation">,</span>                        help<span class="token operator">=</span><span class="token string">'Specify alternate bind address '</span>                             <span class="token string">'[default: all interfaces]'</span><span class="token punctuation">)</span>parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'port'</span><span class="token punctuation">,</span> action<span class="token operator">=</span><span class="token string">'store'</span><span class="token punctuation">,</span>                        default<span class="token operator">=</span><span class="token number">8000</span><span class="token punctuation">,</span> type<span class="token operator">=</span>int<span class="token punctuation">,</span>                        nargs<span class="token operator">=</span><span class="token string">'?'</span><span class="token punctuation">,</span>                        help<span class="token operator">=</span><span class="token string">'Specify alternate port [default: 8000]'</span><span class="token punctuation">)</span>args <span class="token operator">=</span> parser<span class="token punctuation">.</span>parse_args<span class="token punctuation">(</span><span class="token punctuation">)</span>PORT <span class="token operator">=</span> args<span class="token punctuation">.</span>portBIND <span class="token operator">=</span> args<span class="token punctuation">.</span>bindHOST <span class="token operator">=</span> BIND<span class="token keyword">if</span> HOST <span class="token operator">==</span> <span class="token string">''</span><span class="token punctuation">:</span>    HOST <span class="token operator">=</span> <span class="token string">'localhost'</span>Handler <span class="token operator">=</span> SimpleHTTPRequestHandler<span class="token keyword">with</span> socketserver<span class="token punctuation">.</span>TCPServer<span class="token punctuation">(</span><span class="token punctuation">(</span>BIND<span class="token punctuation">,</span> PORT<span class="token punctuation">)</span><span class="token punctuation">,</span> Handler<span class="token punctuation">)</span> <span class="token keyword">as</span> httpd<span class="token punctuation">:</span>    serve_message <span class="token operator">=</span> <span class="token string">"Serving HTTP on &amp;#123;host&amp;#125; port &amp;#123;port&amp;#125; (http://&amp;#123;host&amp;#125;:&amp;#123;port&amp;#125;/) ..."</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>serve_message<span class="token punctuation">.</span>format<span class="token punctuation">(</span>host<span class="token operator">=</span>HOST<span class="token punctuation">,</span> port<span class="token operator">=</span>PORT<span class="token punctuation">)</span><span class="token punctuation">)</span>    httpd<span class="token punctuation">.</span>serve_forever<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> python、文件传输 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>将csv转为对应的灰度图</title>
      <link href="2021/08/16/jiang-csv-zhuan-wei-dui-ying-de-hui-du-tu/"/>
      <url>2021/08/16/jiang-csv-zhuan-wei-dui-ying-de-hui-du-tu/</url>
      
        <content type="html"><![CDATA[<h2 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h2><h3 id="前述"><a href="#前述" class="headerlink" title="前述"></a>前述</h3><p>听着好像有点多余，原本就是要把灰度图转为csv来读取。。</p><h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><p>代码功能详见注释</p><pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np<span class="token keyword">import</span> os<span class="token keyword">from</span> PIL <span class="token keyword">import</span> Image<span class="token keyword">import</span> cv2<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt<span class="token keyword">from</span> tqdm <span class="token keyword">import</span> tqdm<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd<span class="token comment" spellcheck="true">#from config import *</span><span class="token keyword">import</span> dlib<span class="token comment" spellcheck="true">#********************check over</span><span class="token comment" spellcheck="true"># 目的是实现从csv到jpg的转换</span><span class="token comment" spellcheck="true"># conver_csv_to_jpg是实现转换</span><span class="token comment" spellcheck="true"># crop_face_area是实现ROI区域的提取</span><span class="token keyword">def</span> <span class="token function">convert_csv_to_jpg</span><span class="token punctuation">(</span>csv_path<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment" spellcheck="true"># 加载opencv的人脸识别文件</span>    <span class="token comment" spellcheck="true"># 'haarcascade_frontalface_alt' 的准确度更高，但是速度更慢</span>    <span class="token comment" spellcheck="true"># 'haarcascade_frontalface_default' 准确度较低，但是更快而且更轻巧</span>    <span class="token comment" spellcheck="true"># detector = cv2.CascadeClassifier(haarcascade_frontalface_alt)</span>    detector <span class="token operator">=</span> dlib<span class="token punctuation">.</span>get_frontal_face_detector<span class="token punctuation">(</span><span class="token punctuation">)</span>    landmark_predictor <span class="token operator">=</span> dlib<span class="token punctuation">.</span>shape_predictor<span class="token punctuation">(</span>        <span class="token string">'D:\\realsense_window\\CNN-Facial-Expression-Recognition-master\\data\\shape_predictor_68_face_landmarks.dat'</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 将csv通过PIL转换为jpg</span>    data <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span>csv_path<span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">"ISO-8859-1"</span><span class="token punctuation">)</span>    train_path_data <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;'path': [], 'emotion': []&amp;#125;</span>    valid_path_data <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;'path': [], 'emotion': []&amp;#125;</span>    test_path_data <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;'path': [], 'emotion': []&amp;#125;</span>    train_landmark <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    valid_landmark <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    test_landmark <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    <span class="token keyword">if</span> <span class="token operator">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>TRAIN_DIR<span class="token punctuation">)</span><span class="token punctuation">:</span>        os<span class="token punctuation">.</span>mkdir<span class="token punctuation">(</span>TRAIN_DIR<span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token operator">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>TEST_DIR<span class="token punctuation">)</span><span class="token punctuation">:</span>        os<span class="token punctuation">.</span>mkdir<span class="token punctuation">(</span>TEST_DIR<span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token operator">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>VALID_DIR<span class="token punctuation">)</span><span class="token punctuation">:</span>        os<span class="token punctuation">.</span>mkdir<span class="token punctuation">(</span>VALID_DIR<span class="token punctuation">)</span>    total <span class="token operator">=</span> <span class="token number">0</span>    <span class="token comment" spellcheck="true"># 将cssv文件中的数据如emotion，pixel，usage打包成之后读取，同时需要处理多个数据的常用手段</span>    <span class="token keyword">for</span> label<span class="token punctuation">,</span> pixels<span class="token punctuation">,</span> usage <span class="token keyword">in</span> tqdm<span class="token punctuation">(</span>zip<span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token string">'emotion'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> data<span class="token punctuation">[</span><span class="token string">'pixels'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> data<span class="token punctuation">[</span><span class="token string">'Usage'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token comment" spellcheck="true"># 修改文件为指定大小</span>        img <span class="token operator">=</span> np<span class="token punctuation">.</span>asarray<span class="token punctuation">(</span>pixels<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span>            np<span class="token punctuation">.</span>int32<span class="token punctuation">)</span><span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token punctuation">[</span>img_size<span class="token punctuation">,</span> img_size<span class="token punctuation">]</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># 裁剪文件为所需要的人脸部分</span>        all_faces<span class="token punctuation">,</span> all_landmarks <span class="token operator">=</span> crop_face_area<span class="token punctuation">(</span>            detector<span class="token punctuation">,</span> landmark_predictor<span class="token punctuation">,</span> img<span class="token punctuation">,</span> img_size<span class="token punctuation">)</span>        <span class="token keyword">if</span> all_faces <span class="token keyword">is</span> None<span class="token punctuation">:</span>            <span class="token keyword">continue</span>        <span class="token keyword">for</span> img<span class="token punctuation">,</span> landmarks <span class="token keyword">in</span> zip<span class="token punctuation">(</span>all_faces<span class="token punctuation">,</span> all_landmarks<span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token comment" spellcheck="true"># fromarray可以说明img此时为np的矩阵格式，Image中的fromarray这个函数实现从矩阵保存的像素值到照片的转换</span>            img <span class="token operator">=</span> Image<span class="token punctuation">.</span>fromarray<span class="token punctuation">(</span>img<span class="token punctuation">)</span><span class="token punctuation">.</span>convert<span class="token punctuation">(</span>mode<span class="token operator">=</span><span class="token string">'L'</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># 转为单通道</span>            fname <span class="token operator">=</span> str<span class="token punctuation">(</span>total<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'.jpg'</span>  <span class="token comment" spellcheck="true"># filename的格式</span>            <span class="token comment" spellcheck="true"># fer2013.csv中已经实现将各个csv文件的对应内容写好，包括pixel(与转换为照片有关)，emotion(0-6对应于不同的情绪)，usage对应于training，testing，validing</span>            <span class="token keyword">if</span> usage <span class="token operator">==</span> <span class="token string">'Training'</span><span class="token punctuation">:</span>                save_path <span class="token operator">=</span> TRAIN_DIR <span class="token operator">+</span> <span class="token string">'\\'</span> <span class="token operator">+</span> fname  <span class="token comment" spellcheck="true"># 文件的保存路径</span>                train_path_data<span class="token punctuation">[</span><span class="token string">'path'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>fname<span class="token punctuation">)</span>                train_path_data<span class="token punctuation">[</span><span class="token string">'emotion'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>label<span class="token punctuation">)</span>                train_landmark<span class="token punctuation">.</span>append<span class="token punctuation">(</span>landmarks<span class="token punctuation">)</span>            <span class="token keyword">elif</span> usage <span class="token operator">==</span> <span class="token string">'PrivateTest'</span><span class="token punctuation">:</span>                save_path <span class="token operator">=</span> VALID_DIR <span class="token operator">+</span> <span class="token string">'\\'</span> <span class="token operator">+</span> fname                valid_path_data<span class="token punctuation">[</span><span class="token string">'path'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>fname<span class="token punctuation">)</span>                valid_path_data<span class="token punctuation">[</span><span class="token string">'emotion'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>label<span class="token punctuation">)</span>                valid_landmark<span class="token punctuation">.</span>append<span class="token punctuation">(</span>landmarks<span class="token punctuation">)</span>            <span class="token keyword">else</span><span class="token punctuation">:</span>                save_path <span class="token operator">=</span> TEST_DIR <span class="token operator">+</span> <span class="token string">'\\'</span> <span class="token operator">+</span> fname                test_path_data<span class="token punctuation">[</span><span class="token string">'path'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>fname<span class="token punctuation">)</span>                test_path_data<span class="token punctuation">[</span><span class="token string">'emotion'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>label<span class="token punctuation">)</span>                test_landmark<span class="token punctuation">.</span>append<span class="token punctuation">(</span>landmarks<span class="token punctuation">)</span>            img<span class="token punctuation">.</span>save<span class="token punctuation">(</span>save_path<span class="token punctuation">)</span>            total <span class="token operator">+=</span> <span class="token number">1</span>    <span class="token comment" spellcheck="true"># 将train_landmark中的内容转为array格式，np.asarray(file，dtype=floatxx，ord)</span>    train_landmark <span class="token operator">=</span> np<span class="token punctuation">.</span>asarray<span class="token punctuation">(</span>train_landmark<span class="token punctuation">)</span>    valid_landmark <span class="token operator">=</span> np<span class="token punctuation">.</span>asarray<span class="token punctuation">(</span>valid_landmark<span class="token punctuation">)</span>    test_landmark <span class="token operator">=</span> np<span class="token punctuation">.</span>asarray<span class="token punctuation">(</span>test_landmark<span class="token punctuation">)</span>    np<span class="token punctuation">.</span>savez<span class="token punctuation">(</span>TRAIN_LANDMARK_PATH<span class="token punctuation">,</span> landmark<span class="token operator">=</span>train_landmark<span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># 生成npz的压缩文件</span>    np<span class="token punctuation">.</span>savez<span class="token punctuation">(</span>VALID_LANDMARK_PATH<span class="token punctuation">,</span> landmark<span class="token operator">=</span>valid_landmark<span class="token punctuation">)</span>    np<span class="token punctuation">.</span>savez<span class="token punctuation">(</span>TEST_LANDMARK_PATH<span class="token punctuation">,</span> landmark<span class="token operator">=</span>test_landmark<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># dataframe是pandas的存储数据的方式，类似与matlab的矩阵和excel的表格，第一个参数与是用于存储的数据，可以是字符什么的，</span>    <span class="token comment" spellcheck="true"># 第二个数据index和第三个数据column分别代表行和列的标记，注意长度要和所给数据的行列大小一致</span>    <span class="token comment" spellcheck="true"># 例如df=pd.DataFrame([[1,2,3,4],[2,3,4,5],</span>    <span class="token comment" spellcheck="true">#              [3,4,5,6]，[4,5,6,7]],</span>    <span class="token comment" spellcheck="true">#             index=list('ABCD'),columns=list('ABCD'))</span>    <span class="token comment" spellcheck="true"># df=</span>    <span class="token triple-quoted-string string">'''A  B  C  D    A  1  2  3  4    B  2  3  4  5    C  3  4  5  6    D  4  5  6  7    '''</span>    train_path_data <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>train_path_data<span class="token punctuation">)</span>    train_path_data<span class="token punctuation">.</span>to_pickle<span class="token punctuation">(</span>TRAIN_PATH<span class="token punctuation">)</span>    valid_path_data <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>valid_path_data<span class="token punctuation">)</span>    valid_path_data<span class="token punctuation">.</span>to_pickle<span class="token punctuation">(</span>VALID_PATH<span class="token punctuation">)</span>    test_path_data <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>test_path_data<span class="token punctuation">)</span>    test_path_data<span class="token punctuation">.</span>to_pickle<span class="token punctuation">(</span>TEST_PATH<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 输出training，testing，validing中文件的个数</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Total: &amp;#123;&amp;#125;, training: &amp;#123;&amp;#125;, valid: &amp;#123;&amp;#125;, test: &amp;#123;&amp;#125;'</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>        total<span class="token punctuation">,</span> len<span class="token punctuation">(</span>train_path_data<span class="token punctuation">)</span><span class="token punctuation">,</span> len<span class="token punctuation">(</span>valid_path_data<span class="token punctuation">)</span><span class="token punctuation">,</span> len<span class="token punctuation">(</span>test_path_data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">crop_face_area</span><span class="token punctuation">(</span>detector<span class="token punctuation">,</span> landmark_predictor<span class="token punctuation">,</span> image<span class="token punctuation">,</span> img_size<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""    裁剪图像的人脸部分，并resize到img_size尺寸    :param detector:    :param image:    :param img_size:    :return: Two numpy arrays containing the area and landmarks of all faces.    None if no face was detected.    """</span>    <span class="token comment" spellcheck="true"># p_img = Image.fromarray(image).convert(mode='RGB')</span>    <span class="token comment" spellcheck="true"># cv_img = cv2.cvtColor(np.asarray(p_img), cv2.COLOR_RGB2GRAY)</span>    <span class="token comment" spellcheck="true"># faces = detector.detectMultiScale(</span>    <span class="token comment" spellcheck="true">#     image=cv_img,</span>    <span class="token comment" spellcheck="true">#     scaleFactor=1.1,</span>    <span class="token comment" spellcheck="true">#     minNeighbors=1,</span>    <span class="token comment" spellcheck="true">#     minSize=(30, 30),</span>    <span class="token comment" spellcheck="true">#     flags=0</span>    <span class="token comment" spellcheck="true"># )</span>    <span class="token comment" spellcheck="true"># if len(faces) != 0:</span>    <span class="token comment" spellcheck="true">#     x, y, w, h = faces[0]</span>    <span class="token comment" spellcheck="true">#     cv_img = cv2.resize(cv_img[x:x + w, y:y + h], (img_size, img_size))</span>    <span class="token comment" spellcheck="true">#     return np.asarray(cv_img)</span>    <span class="token comment" spellcheck="true"># else:</span>    <span class="token comment" spellcheck="true">#     return None</span>    <span class="token comment" spellcheck="true"># 将image从np.array转化为RGB的照片的格式</span>    p_img <span class="token operator">=</span> Image<span class="token punctuation">.</span>fromarray<span class="token punctuation">(</span>image<span class="token punctuation">)</span><span class="token punctuation">.</span>convert<span class="token punctuation">(</span>mode<span class="token operator">=</span><span class="token string">'RGB'</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 将P_img从ＲＧＢ转为灰度图</span>    cv_img <span class="token operator">=</span> cv2<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>np<span class="token punctuation">.</span>asarray<span class="token punctuation">(</span>p_img<span class="token punctuation">)</span><span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>COLOR_RGB2GRAY<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 检测灰度图cv_img中的人脸</span>    faces <span class="token operator">=</span> detector<span class="token punctuation">(</span>cv_img<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>    all_landmarks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    all_faces <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    <span class="token keyword">if</span> len<span class="token punctuation">(</span>faces<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">:</span>        <span class="token keyword">for</span> face <span class="token keyword">in</span> faces<span class="token punctuation">:</span>            shape <span class="token operator">=</span> landmark_predictor<span class="token punctuation">(</span>cv_img<span class="token punctuation">,</span> face<span class="token punctuation">)</span>            landmarks <span class="token operator">=</span> np<span class="token punctuation">.</span>ndarray<span class="token punctuation">(</span>shape<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">68</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>            <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">68</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                landmarks<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>shape<span class="token punctuation">.</span>part<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span>x<span class="token punctuation">,</span> shape<span class="token punctuation">.</span>part<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span>y<span class="token punctuation">)</span>            all_landmarks<span class="token punctuation">.</span>append<span class="token punctuation">(</span>landmarks<span class="token punctuation">)</span>            x1<span class="token punctuation">,</span> y1<span class="token punctuation">,</span> x2<span class="token punctuation">,</span> y2 <span class="token operator">=</span> face<span class="token punctuation">.</span>left<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> face<span class="token punctuation">.</span>top<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> face<span class="token punctuation">.</span>right<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> face<span class="token punctuation">.</span>bottom<span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token comment" spellcheck="true"># 裁剪照片多余的部分</span>            <span class="token keyword">if</span> x1 <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">:</span>                x1 <span class="token operator">=</span> <span class="token number">0</span>            <span class="token keyword">if</span> x1 <span class="token operator">></span> cv_img<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">:</span>                x1 <span class="token operator">=</span> cv_img<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>            <span class="token keyword">if</span> x2 <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">:</span>                x2 <span class="token operator">=</span> <span class="token number">0</span>            <span class="token keyword">if</span> x2 <span class="token operator">></span> cv_img<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">:</span>                x2 <span class="token operator">=</span> cv_img<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>            <span class="token keyword">if</span> y1 <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">:</span>                y1 <span class="token operator">=</span> <span class="token number">0</span>            <span class="token keyword">if</span> y1 <span class="token operator">></span> cv_img<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">:</span>                y1 <span class="token operator">=</span> cv_img<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>            <span class="token keyword">if</span> y2 <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">:</span>                y2 <span class="token operator">=</span> <span class="token number">0</span>            <span class="token keyword">if</span> y2 <span class="token operator">></span> cv_img<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">:</span>                y2 <span class="token operator">=</span> cv_img<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>            img <span class="token operator">=</span> cv2<span class="token punctuation">.</span>resize<span class="token punctuation">(</span>cv_img<span class="token punctuation">[</span>y1<span class="token punctuation">:</span>y2<span class="token punctuation">,</span> x1<span class="token punctuation">:</span>x2<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>img_size<span class="token punctuation">,</span> img_size<span class="token punctuation">)</span><span class="token punctuation">)</span>            all_faces<span class="token punctuation">.</span>append<span class="token punctuation">(</span>img<span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># 返回每张照片img中的人脸所在的位置</span>        <span class="token keyword">return</span> np<span class="token punctuation">.</span>asarray<span class="token punctuation">(</span>all_faces<span class="token punctuation">)</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>asarray<span class="token punctuation">(</span>all_landmarks<span class="token punctuation">)</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> None<span class="token punctuation">,</span> None<span class="token triple-quoted-string string">'''def count_lines(csv_path):    data = pd.read_csv(csv_path, encoding="ISO-8859-1")    return data.shape[0]    #data.shape[0]代表csv文件中有多少行，也即有多少张照片'''</span><span class="token triple-quoted-string string">'''def show_class_distribution(file_path):    label_num = np.zeros([7], dtype=np.int32)    data = pd.read_csv(file_path)    for label in data['emotion']:        label_num[label] += 1  # get the name of emotions alreay-known    rects = plt.bar(class_names, label_num)    plt.title('Label Distribution')    plt.xlabel("Label")    plt.ylabel("Number")    for rect in rects:        height = rect.get_height()        plt.text(rect.get_x() + rect.get_width() / 2, height +                 1, str(height), ha="center", va="bottom")    plt.show()'''</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    DATA_PATH <span class="token operator">=</span> <span class="token string">'D:\\2019-10-19\\csv\\fer2013_2.csv'</span>    convert_csv_to_jpg<span class="token punctuation">(</span>DATA_PATH<span class="token punctuation">)</span></code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hello World</title>
      <link href="2021/01/14/hello-world/"/>
      <url>2021/01/14/hello-world/</url>
      
        <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><pre class=" language-bash"><code class="language-bash">$ hexo new <span class="token string">"My New Post"</span></code></pre><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><pre class=" language-bash"><code class="language-bash">$ hexo server</code></pre><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><pre class=" language-bash"><code class="language-bash">$ hexo generate</code></pre><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><pre class=" language-bash"><code class="language-bash">$ hexo deploy</code></pre><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
      
      
      
    </entry>
    
    
  
  
</search>
